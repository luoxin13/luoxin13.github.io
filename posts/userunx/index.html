<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>RUNX 使用教程 | Mr.Head's Blog</title><meta name=keywords content="实验教程,环境配置,深度学习实验"><meta name=description content="0. 简介 RUNX 是 NVIDIA 开发的一款实验管理工具，旨在自动化执行一系列命令行任务，主要功能包括：
超参数调优/消融实验分析：以不同参数运行实验代码，再进行性能比较 日志记录：管理过程中的日志，支持文本、TensorBoard等 模型检查点：保存管理 checkpoints 实验总结：对运行不同参数得到的结果生成列表总结 代码备份：不同参数运行时将代码备份到各自文件夹，方便 debugging 1. 主要组件 runx.runx
该组件对实验中的超参数进行处理，根据不同的超参数组合，生成一系列运行命令，对每个命令建立独立的运行文件夹，备份代码至相关文件夹，并将当前运行环境配置、运行超参数等以 yaml 文件形式写入相关文件夹
runx.logx
该组件记录和管理实验过程中的日志，主要包括 metrics、messages、checkpoints 等部分，可替代日常使用的 logging、torch.save、SummaryWriter、print 等日志和模型存放方式
runx.sumx
该组件对不同运行配置得到的结果进行分析整理，根据预先定义的指标对模型进行排序，便于分析/选择最优模型
2. 安装配置 通过 pip 安装：
1 2 3 git clone https://github.com/NVIDIA/runx cd runx python setup.py install --user 通过源码安装：
1 git clone 3. 基本使用教程 3.0. 基本假设 假定代码运行时有 param1 和 param2 两个参数，运行命令为： 1 python main.py --param1 p1 --param2 p2 --logdir ./logs 代码 main.py 中包含对超参数的处理，日志、模型等保存在参数 logdir 指定的目录下 3."><meta name=author content="Xin LUO"><link rel=canonical href=https://luoxin13.github.io/posts/userunx/><link crossorigin=anonymous href=/assets/css/stylesheet.f147d91e858a1059bca95c143bb84f4bbb94f0e9c942165647e81f8cdfc36595.css integrity="sha256-8UfZHoWKEFm8qVwUO7hPS7uU8OnJQhZWR+gfjN/DZZU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://luoxin13.github.io/icons/pika.ico><link rel=icon type=image/png sizes=16x16 href=https://luoxin13.github.io/icons/pika.ico><link rel=icon type=image/png sizes=32x32 href=https://luoxin13.github.io/icons/pika.ico><link rel=apple-touch-icon href=https://luoxin13.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://luoxin13.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><meta property="og:title" content="RUNX 使用教程"><meta property="og:description" content="0. 简介 RUNX 是 NVIDIA 开发的一款实验管理工具，旨在自动化执行一系列命令行任务，主要功能包括：
超参数调优/消融实验分析：以不同参数运行实验代码，再进行性能比较 日志记录：管理过程中的日志，支持文本、TensorBoard等 模型检查点：保存管理 checkpoints 实验总结：对运行不同参数得到的结果生成列表总结 代码备份：不同参数运行时将代码备份到各自文件夹，方便 debugging 1. 主要组件 runx.runx
该组件对实验中的超参数进行处理，根据不同的超参数组合，生成一系列运行命令，对每个命令建立独立的运行文件夹，备份代码至相关文件夹，并将当前运行环境配置、运行超参数等以 yaml 文件形式写入相关文件夹
runx.logx
该组件记录和管理实验过程中的日志，主要包括 metrics、messages、checkpoints 等部分，可替代日常使用的 logging、torch.save、SummaryWriter、print 等日志和模型存放方式
runx.sumx
该组件对不同运行配置得到的结果进行分析整理，根据预先定义的指标对模型进行排序，便于分析/选择最优模型
2. 安装配置 通过 pip 安装：
1 2 3 git clone https://github.com/NVIDIA/runx cd runx python setup.py install --user 通过源码安装：
1 git clone 3. 基本使用教程 3.0. 基本假设 假定代码运行时有 param1 和 param2 两个参数，运行命令为： 1 python main.py --param1 p1 --param2 p2 --logdir ./logs 代码 main.py 中包含对超参数的处理，日志、模型等保存在参数 logdir 指定的目录下 3."><meta property="og:type" content="article"><meta property="og:url" content="https://luoxin13.github.io/posts/userunx/"><meta property="og:image" content="https://luoxin13.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-30T20:00:00+08:00"><meta property="article:modified_time" content="2022-06-30T20:00:00+08:00"><meta property="og:site_name" content="Mr.Head's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://luoxin13.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="RUNX 使用教程"><meta name=twitter:description content="0. 简介 RUNX 是 NVIDIA 开发的一款实验管理工具，旨在自动化执行一系列命令行任务，主要功能包括：
超参数调优/消融实验分析：以不同参数运行实验代码，再进行性能比较 日志记录：管理过程中的日志，支持文本、TensorBoard等 模型检查点：保存管理 checkpoints 实验总结：对运行不同参数得到的结果生成列表总结 代码备份：不同参数运行时将代码备份到各自文件夹，方便 debugging 1. 主要组件 runx.runx
该组件对实验中的超参数进行处理，根据不同的超参数组合，生成一系列运行命令，对每个命令建立独立的运行文件夹，备份代码至相关文件夹，并将当前运行环境配置、运行超参数等以 yaml 文件形式写入相关文件夹
runx.logx
该组件记录和管理实验过程中的日志，主要包括 metrics、messages、checkpoints 等部分，可替代日常使用的 logging、torch.save、SummaryWriter、print 等日志和模型存放方式
runx.sumx
该组件对不同运行配置得到的结果进行分析整理，根据预先定义的指标对模型进行排序，便于分析/选择最优模型
2. 安装配置 通过 pip 安装：
1 2 3 git clone https://github.com/NVIDIA/runx cd runx python setup.py install --user 通过源码安装：
1 git clone 3. 基本使用教程 3.0. 基本假设 假定代码运行时有 param1 和 param2 两个参数，运行命令为： 1 python main.py --param1 p1 --param2 p2 --logdir ./logs 代码 main.py 中包含对超参数的处理，日志、模型等保存在参数 logdir 指定的目录下 3."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://luoxin13.github.io/posts/"},{"@type":"ListItem","position":3,"name":"RUNX 使用教程","item":"https://luoxin13.github.io/posts/userunx/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"RUNX 使用教程","name":"RUNX 使用教程","description":"0. 简介 RUNX 是 NVIDIA 开发的一款实验管理工具，旨在自动化执行一系列命令行任务，主要功能包括：\n超参数调优/消融实验分析：以不同参数运行实验代码，再进行性能比较 日志记录：管理过程中的日志，支持文本、TensorBoard等 模型检查点：保存管理 checkpoints 实验总结：对运行不同参数得到的结果生成列表总结 代码备份：不同参数运行时将代码备份到各自文件夹，方便 debugging 1. 主要组件 runx.runx\n该组件对实验中的超参数进行处理，根据不同的超参数组合，生成一系列运行命令，对每个命令建立独立的运行文件夹，备份代码至相关文件夹，并将当前运行环境配置、运行超参数等以 yaml 文件形式写入相关文件夹\nrunx.logx\n该组件记录和管理实验过程中的日志，主要包括 metrics、messages、checkpoints 等部分，可替代日常使用的 logging、torch.save、SummaryWriter、print 等日志和模型存放方式\nrunx.sumx\n该组件对不同运行配置得到的结果进行分析整理，根据预先定义的指标对模型进行排序，便于分析/选择最优模型\n2. 安装配置 通过 pip 安装：\n1 2 3 git clone https://github.com/NVIDIA/runx cd runx python setup.py install --user 通过源码安装：\n1 git clone 3. 基本使用教程 3.0. 基本假设 假定代码运行时有 param1 和 param2 两个参数，运行命令为： 1 python main.py --param1 p1 --param2 p2 --logdir ./logs 代码 main.py 中包含对超参数的处理，日志、模型等保存在参数 logdir 指定的目录下 3.","keywords":["实验教程","环境配置","深度学习实验"],"articleBody":"0. 简介 RUNX 是 NVIDIA 开发的一款实验管理工具，旨在自动化执行一系列命令行任务，主要功能包括：\n超参数调优/消融实验分析：以不同参数运行实验代码，再进行性能比较 日志记录：管理过程中的日志，支持文本、TensorBoard等 模型检查点：保存管理 checkpoints 实验总结：对运行不同参数得到的结果生成列表总结 代码备份：不同参数运行时将代码备份到各自文件夹，方便 debugging 1. 主要组件 runx.runx\n该组件对实验中的超参数进行处理，根据不同的超参数组合，生成一系列运行命令，对每个命令建立独立的运行文件夹，备份代码至相关文件夹，并将当前运行环境配置、运行超参数等以 yaml 文件形式写入相关文件夹\nrunx.logx\n该组件记录和管理实验过程中的日志，主要包括 metrics、messages、checkpoints 等部分，可替代日常使用的 logging、torch.save、SummaryWriter、print 等日志和模型存放方式\nrunx.sumx\n该组件对不同运行配置得到的结果进行分析整理，根据预先定义的指标对模型进行排序，便于分析/选择最优模型\n2. 安装配置 通过 pip 安装：\n1 2 3 git clone https://github.com/NVIDIA/runx cd runx python setup.py install --user 通过源码安装：\n1 git clone 3. 基本使用教程 3.0. 基本假设 假定代码运行时有 param1 和 param2 两个参数，运行命令为： 1 python main.py --param1 p1 --param2 p2 --logdir ./logs 代码 main.py 中包含对超参数的处理，日志、模型等保存在参数 logdir 指定的目录下 3.1. runx 基本配置 在 main.py 所在目录下新建一个隐藏文件 ./.runx 1 touch ./.runx 修改 ./.runx 文件内容，注意必须配置 LOGROOT， 该配置为存放所有记录文件的目录路径，注意该路径不能在当前路径下（否则代码备份时会陷入无限循环）。例如： 1 LOGROOT: /OtherPath/RUNX-LOGS 可以根据官方教程进行其他项配置 3.2. 使用 runx.runx 在 main.py 所在目录下新建一个文件 experiment.yml，注意此处的 experiment 为运行的实验名，可以根据需要进行修改，例如可新建为 tune-lr.yml。实验名为最终生成的根目录，若上述的 LOGROOT 设置为 /OtherPath/RUNX-LOGS，实验名设置为 exp，则最终所有运行的实验都在目录 /OtherPath/RUNX-LOGS/exp 中 1 touch ./experiment.yml 修改 ./experiment.yml 文件内容，将 CMD 参数设置为运行的基础命令，将运行过程中的其他超参数在 HPARAMS 中进行设置，例如： 1 2 3 4 5 6 CMD: 'python main.py' HPARAMS: param1: [0.01, 0.02] param2: ['str1', 'str2'] logdir: LOGDIR # LOGDIR 表示在当前的日志目录下 完成上述配置后，可以通过运行 python -m runx.runx experiment.yml -i 开始实验，此时如果是在本地运行（非集群/任务）记得加上 -i 选项（interactive mode）。当然，也可以加上 -n 选项，此时只打印将运行的批处理命令而不实际运行这些命令。\n由于运行的目标是单独存放每个参数配置的实验结果，runx 会给每次运行的代码、日志、tensorboard记录文件等单独创建一个文件夹，在 .yml 配置文件中可以通过 LOGDIR 访问该目录（如上述的例子中使用 LOGDIR 作为参数 logdir 的实际取值）。\n3.3. 使用 runx.logx 为了便于观察实验运行状况、调试代码、对实验结果进行分析，需要对代码运行过程中的一些状态值进行记录，经过一定阶段，还需要进行模型保存等操作，为此 runx 提供了 logx 模块，runx.logx 可以完成诸如 print、logging 的基础日志/输出功能，还可以完成 tensorboard 等高级日志记录工具的功能；此外，由于后续需要根据运行结果选择最优超参数，runx.logx 可以记录模型运行过程中的评测指标（metric），为后续 runx.sumx 的整理分析提供数据支持。\n使用 runx.logx 之前需要进行导入和初始化： 1 2 3 4 5 6 7 8 9 10 from runx.logx import logx # args 为 argparse 模块提供的参数解析 NameSpace logx.initialize( logdir=args.logdir, coolname=True, tensorboard=True, hparams=vars(args) ) 训练过程中可以保存运行状态的值： 1 2 3 4 5 6 7 8 9 10 logx.metric( phase='train', metrics={'loss': 10.0}, epoch=5 ) logx.metric( phase='val', metrics={'accuracy': 100.0}, epoch=5 ) 训练过程中保存模型： 1 2 3 4 5 6 7 # model 为网络模型 save_model( {'state_dict': model.state_dict()}, metric={'accuracy': 100.0}, epoch=5, higher_better=True ) 训练过程中代替 print 等进行训练日志输出： 1 logx.msg(\"string to print\") 训练过程中的替代总结: 原始函数 替代函数 功能 print() logx.msg() 输出信息 writer.add_scalar() logx.add_scalar() 记录标量值 (TensorBoard) writer.add_image() logx.add_image() 记录图像 (TensorBoard) torch.save() logx.save_model() 保存最近的/最好的模型参数 3.4. 使用 runx.sumx 运行 runx.runx 后，在 runx 指定的日志根目录下会生成一个 exepriment 目录 （该目录名由配置文件名指定），目录下有若干个子目录，每个子目录代表一种超参数配置下的代码及运行结果。\n为了对这些实验结果进行分析，知道每个 epoch 平均运行时间、测试精度等，选择最优的参数组合，runx 提供了对运行结果进行整理分析的模块，即 runx.sumx。\n在前述的 runx.runx 运行目录下，runx.sumx 可以访问实验的根目录，即 LOGROOT，要使用 runx.sumx，只需要指定实验中想进行评估的指标即可。\n例如上述的 runx.logx 记录了名为 accuracy 的性能指标，则此时可以分析：\n1 python -m runx.sumx experiment --sortwith accuracy 此时可以得到输出，例如官方示例给出的输出：\n1 2 3 4 5 6 python -m runx.sumx experiment --sortwith accuracy lr solver accuracy epoch epoch_time run4 0.02 adam 99.1 10 5:21 run3 0.02 sgd 99.0 10 5:02 run1 0.01 sgd 98.2 10 5:40 run2 0.01 adam 98.1 10 5:25 ","wordCount":"347","inLanguage":"en","datePublished":"2022-06-30T20:00:00+08:00","dateModified":"2022-06-30T20:00:00+08:00","author":{"@type":"Person","name":"Xin LUO"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://luoxin13.github.io/posts/userunx/"},"publisher":{"@type":"Organization","name":"Mr.Head's Blog","logo":{"@type":"ImageObject","url":"https://luoxin13.github.io/icons/pika.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://luoxin13.github.io accesskey=h title="Xin LUO's Blog (Alt + H)">Xin LUO's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://luoxin13.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://luoxin13.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://luoxin13.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://luoxin13.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://luoxin13.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://luoxin13.github.io>Home</a>&nbsp;»&nbsp;<a href=https://luoxin13.github.io/posts/>Posts</a></div><h1 class=post-title>RUNX 使用教程</h1><div class=post-meta><span title='2022-06-30 20:00:00 +0800 CST'>June 30, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;347 words&nbsp;·&nbsp;Xin LUO</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#0-简介>0. 简介</a></li><li><a href=#1-主要组件>1. 主要组件</a></li><li><a href=#2-安装配置>2. 安装配置</a></li><li><a href=#3-基本使用教程>3. 基本使用教程</a><ul><li><a href=#30-基本假设>3.0. 基本假设</a></li><li><a href=#31-runx-基本配置>3.1. runx 基本配置</a></li><li><a href=#32-使用-runxrunx>3.2. 使用 runx.runx</a></li><li><a href=#33-使用-runxlogx>3.3. 使用 runx.logx</a></li><li><a href=#34-使用-runxsumx>3.4. 使用 runx.sumx</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=0-简介>0. 简介<a hidden class=anchor aria-hidden=true href=#0-简介>#</a></h2><p><a href=https://github.com/NVIDIA/runx><strong>RUNX</strong></a> 是 NVIDIA 开发的一款实验管理工具，旨在自动化执行一系列命令行任务，主要功能包括：</p><ul><li>超参数调优/消融实验分析：以不同参数运行实验代码，再进行性能比较</li><li>日志记录：管理过程中的日志，支持文本、TensorBoard等</li><li>模型检查点：保存管理 checkpoints</li><li>实验总结：对运行不同参数得到的结果生成列表总结</li><li>代码备份：不同参数运行时将代码备份到各自文件夹，方便 debugging</li></ul><h2 id=1-主要组件>1. 主要组件<a hidden class=anchor aria-hidden=true href=#1-主要组件>#</a></h2><ul><li><p>runx.runx</p><p>该组件对实验中的超参数进行处理，根据不同的超参数组合，生成一系列运行命令，对每个命令建立独立的运行文件夹，备份代码至相关文件夹，并将当前运行环境配置、运行超参数等以 yaml 文件形式写入相关文件夹</p></li><li><p>runx.logx</p><p>该组件记录和管理实验过程中的日志，主要包括 metrics、messages、checkpoints 等部分，可替代日常使用的 logging、torch.save、SummaryWriter、print 等日志和模型存放方式</p></li><li><p>runx.sumx</p><p>该组件对不同运行配置得到的结果进行分析整理，根据预先定义的指标对模型进行排序，便于分析/选择最优模型</p></li></ul><h2 id=2-安装配置>2. 安装配置<a hidden class=anchor aria-hidden=true href=#2-安装配置>#</a></h2><p>通过 pip 安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span class=lnt id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span class=lnt id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/NVIDIA/runx
</span></span><span class=line><span class=cl><span class=nb>cd</span> runx
</span></span><span class=line><span class=cl>python setup.py install --user
</span></span></code></pre></td></tr></table></div></div><p>通过源码安装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone 
</span></span></code></pre></td></tr></table></div></div><h2 id=3-基本使用教程>3. 基本使用教程<a hidden class=anchor aria-hidden=true href=#3-基本使用教程>#</a></h2><h3 id=30-基本假设>3.0. 基本假设<a hidden class=anchor aria-hidden=true href=#30-基本假设>#</a></h3><ul><li>假定代码运行时有 <strong>param1</strong> 和 <strong>param2</strong> 两个参数，运行命令为：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python main.py --param1 p1 --param2 p2 --logdir ./logs
</span></span></code></pre></td></tr></table></div></div><ul><li>代码 <strong>main.py</strong> 中包含对超参数的处理，日志、模型等保存在参数 logdir 指定的目录下</li></ul><h3 id=31-runx-基本配置>3.1. runx 基本配置<a hidden class=anchor aria-hidden=true href=#31-runx-基本配置>#</a></h3><ul><li>在 main.py 所在目录下新建一个隐藏文件 <strong>./.runx</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>touch ./.runx
</span></span></code></pre></td></tr></table></div></div><ul><li>修改 <strong>./.runx</strong> 文件内容，注意必须配置 <strong>LOGROOT</strong>， 该配置为存放所有记录文件的目录路径，注意该路径不能在当前路径下（否则代码备份时会陷入无限循环）。例如：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>LOGROOT</span><span class=p>:</span><span class=w> </span><span class=l>/OtherPath/RUNX-LOGS</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>可以根据<a href=https://github.com/NVIDIA/runx><strong>官方教程</strong></a>进行其他项配置</li></ul><h3 id=32-使用-runxrunx>3.2. 使用 runx.runx<a hidden class=anchor aria-hidden=true href=#32-使用-runxrunx>#</a></h3><ul><li>在 main.py 所在目录下新建一个文件 <strong>experiment.yml</strong>，注意此处的 <strong>experiment</strong> 为运行的实验名，可以根据需要进行修改，例如可新建为 <strong>tune-lr.yml</strong>。实验名为最终生成的根目录，若上述的 LOGROOT 设置为 /OtherPath/RUNX-LOGS，实验名设置为 exp，则最终所有运行的实验都在目录 /OtherPath/RUNX-LOGS/exp 中</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>touch ./experiment.yml
</span></span></code></pre></td></tr></table></div></div><ul><li>修改 <strong>./experiment.yml</strong> 文件内容，将 <strong>CMD</strong> 参数设置为运行的基础命令，将运行过程中的其他超参数在 <strong>HPARAMS</strong> 中进行设置，例如：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-4>4</a>
</span><span class=lnt id=hl-6-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-5>5</a>
</span><span class=lnt id=hl-6-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>CMD</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;python main.py&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>HPARAMS</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>param1</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=m>0.01</span><span class=p>,</span><span class=w> </span><span class=m>0.02</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>param2</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;str1&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;str2&#39;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>logdir</span><span class=p>:</span><span class=w> </span><span class=l>LOGDIR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># LOGDIR 表示在当前的日志目录下</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>完成上述配置后，可以通过运行 <code>python -m runx.runx experiment.yml -i</code> 开始实验，此时如果是在本地运行（非集群/任务）记得加上 <code>-i</code> 选项（interactive mode）。当然，也可以加上 <code>-n</code> 选项，此时只打印将运行的批处理命令而不实际运行这些命令。</p><p>由于运行的目标是单独存放每个参数配置的实验结果，runx 会给每次运行的代码、日志、tensorboard记录文件等单独创建一个文件夹，在 <code>.yml</code> 配置文件中可以通过 <strong>LOGDIR</strong> 访问该目录（如上述的例子中使用 <strong>LOGDIR</strong> 作为参数 logdir 的实际取值）。</p><h3 id=33-使用-runxlogx>3.3. 使用 runx.logx<a hidden class=anchor aria-hidden=true href=#33-使用-runxlogx>#</a></h3><p>为了便于观察实验运行状况、调试代码、对实验结果进行分析，需要对代码运行过程中的一些状态值进行记录，经过一定阶段，还需要进行模型保存等操作，为此 runx 提供了 logx 模块，<strong>runx.logx</strong> 可以完成诸如 <code>print</code>、<code>logging</code> 的基础日志/输出功能，还可以完成 tensorboard 等高级日志记录工具的功能；此外，由于后续需要根据运行结果选择最优超参数，runx.logx 可以记录模型运行过程中的评测指标（metric），为后续 runx.sumx 的整理分析提供数据支持。</p><ul><li>使用 runx.logx 之前需要进行导入和初始化：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1> 1</a>
</span><span class=lnt id=hl-7-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-2> 2</a>
</span><span class=lnt id=hl-7-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-3> 3</a>
</span><span class=lnt id=hl-7-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-4> 4</a>
</span><span class=lnt id=hl-7-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-5> 5</a>
</span><span class=lnt id=hl-7-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-6> 6</a>
</span><span class=lnt id=hl-7-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-7> 7</a>
</span><span class=lnt id=hl-7-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-8> 8</a>
</span><span class=lnt id=hl-7-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-9> 9</a>
</span><span class=lnt id=hl-7-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>runx.logx</span> <span class=kn>import</span> <span class=n>logx</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># args 为 argparse 模块提供的参数解析 NameSpace</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>logx</span><span class=o>.</span><span class=n>initialize</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>logdir</span><span class=o>=</span><span class=n>args</span><span class=o>.</span><span class=n>logdir</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>coolname</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>tensorboard</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>hparams</span><span class=o>=</span><span class=nb>vars</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>训练过程中可以保存运行状态的值：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1> 1</a>
</span><span class=lnt id=hl-8-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-2> 2</a>
</span><span class=lnt id=hl-8-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-3> 3</a>
</span><span class=lnt id=hl-8-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-4> 4</a>
</span><span class=lnt id=hl-8-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-5> 5</a>
</span><span class=lnt id=hl-8-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-6> 6</a>
</span><span class=lnt id=hl-8-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-7> 7</a>
</span><span class=lnt id=hl-8-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-8> 8</a>
</span><span class=lnt id=hl-8-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-9> 9</a>
</span><span class=lnt id=hl-8-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>logx</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>phase</span><span class=o>=</span><span class=s1>&#39;train&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>metrics</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;loss&#39;</span><span class=p>:</span> <span class=mf>10.0</span><span class=p>},</span> 
</span></span><span class=line><span class=cl>    <span class=n>epoch</span><span class=o>=</span><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logx</span><span class=o>.</span><span class=n>metric</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>phase</span><span class=o>=</span><span class=s1>&#39;val&#39;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>metrics</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;accuracy&#39;</span><span class=p>:</span> <span class=mf>100.0</span><span class=p>},</span> 
</span></span><span class=line><span class=cl>    <span class=n>epoch</span><span class=o>=</span><span class=mi>5</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>训练过程中保存模型：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-4>4</a>
</span><span class=lnt id=hl-9-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-5>5</a>
</span><span class=lnt id=hl-9-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-6>6</a>
</span><span class=lnt id=hl-9-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># model 为网络模型</span>
</span></span><span class=line><span class=cl><span class=n>save_model</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s1>&#39;state_dict&#39;</span><span class=p>:</span> <span class=n>model</span><span class=o>.</span><span class=n>state_dict</span><span class=p>()},</span> 
</span></span><span class=line><span class=cl>    <span class=n>metric</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;accuracy&#39;</span><span class=p>:</span> <span class=mf>100.0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>epoch</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=n>higher_better</span><span class=o>=</span><span class=kc>True</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>训练过程中代替 <code>print</code> 等进行训练日志输出：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>logx</span><span class=o>.</span><span class=n>msg</span><span class=p>(</span><span class=s2>&#34;string to print&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>训练过程中的替代总结:</li></ul><table><thead><tr><th>原始函数</th><th>替代函数</th><th>功能</th></tr></thead><tbody><tr><td>print()</td><td>logx.msg()</td><td>输出信息</td></tr><tr><td>writer.add_scalar()</td><td>logx.add_scalar()</td><td>记录标量值 (TensorBoard)</td></tr><tr><td>writer.add_image()</td><td>logx.add_image()</td><td>记录图像 (TensorBoard)</td></tr><tr><td>torch.save()</td><td>logx.save_model()</td><td>保存最近的/最好的模型参数</td></tr></tbody></table><h3 id=34-使用-runxsumx>3.4. 使用 runx.sumx<a hidden class=anchor aria-hidden=true href=#34-使用-runxsumx>#</a></h3><p>运行 runx.runx 后，在 runx 指定的日志根目录下会生成一个 exepriment 目录 （该目录名由配置文件名指定），目录下有若干个子目录，每个子目录代表一种超参数配置下的代码及运行结果。</p><p>为了对这些实验结果进行分析，知道每个 epoch 平均运行时间、测试精度等，选择最优的参数组合，runx 提供了对运行结果进行整理分析的模块，即 <strong>runx.sumx</strong>。</p><p>在前述的 runx.runx 运行目录下，runx.sumx 可以访问实验的根目录，即 LOGROOT，要使用 runx.sumx，只需要指定实验中想进行评估的指标即可。</p><p>例如上述的 runx.logx 记录了名为 <code>accuracy</code> 的性能指标，则此时可以分析：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python -m runx.sumx experiment --sortwith accuracy
</span></span></code></pre></td></tr></table></div></div><p>此时可以得到输出，例如<a href=https://github.com/NVIDIA/runx>官方示例</a>给出的输出：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-4>4</a>
</span><span class=lnt id=hl-12-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-5>5</a>
</span><span class=lnt id=hl-12-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python -m runx.sumx experiment --sortwith accuracy
</span></span><span class=line><span class=cl>        lr    solver  accuracy   epoch  epoch_time
</span></span><span class=line><span class=cl>run4    0.02  adam    99.1       <span class=m>10</span>     5:21
</span></span><span class=line><span class=cl>run3    0.02  sgd     99.0       <span class=m>10</span>     5:02
</span></span><span class=line><span class=cl>run1    0.01  sgd     98.2       <span class=m>10</span>     5:40
</span></span><span class=line><span class=cl>run2    0.01  adam    98.1       <span class=m>10</span>     5:25
</span></span></code></pre></td></tr></table></div></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://luoxin13.github.io/tags/%E5%AE%9E%E9%AA%8C%E6%95%99%E7%A8%8B/>实验教程</a></li><li><a href=https://luoxin13.github.io/tags/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/>环境配置</a></li><li><a href=https://luoxin13.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%AE%9E%E9%AA%8C/>深度学习实验</a></li></ul><nav class=paginav><a class=prev href=https://luoxin13.github.io/posts/paper-not-2022-08-15-01/><span class=title>« Prev</span><br><span>Paper Not 2022 08 15 01</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://luoxin13.github.io>Mr.Head's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>